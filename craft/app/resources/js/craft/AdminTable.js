Craft.AdminTable=Garnish.Base.extend({settings:null,totalObjects:null,sorter:null,$noObjects:null,$table:null,$tbody:null,$deleteBtns:null,init:function(t){this.setSettings(t,Craft.AdminTable.defaults),this.settings.allowDeleteAll||(this.settings.minObjects=1),this.$noObjects=$(this.settings.noObjectsSelector),this.$table=$(this.settings.tableSelector),this.$tbody=this.$table.children("tbody"),this.totalObjects=this.$tbody.children().length,this.settings.sortable&&(this.sorter=new Craft.DataTableSorter(this.$table,{onSortChange:$.proxy(this,"reorderObjects")})),this.$deleteBtns=this.$table.find(".delete"),this.addListener(this.$deleteBtns,"click","handleDeleteBtnClick"),this.updateUI()},addRow:function(t){if(!(this.settings.maxObjects&&this.totalObjects>=this.settings.maxObjects)){var e=$(t).appendTo(this.$tbody),s=e.find(".delete");this.settings.sortable&&this.sorter.addItems(e),this.$deleteBtns=this.$deleteBtns.add(s),this.addListener(s,"click","handleDeleteBtnClick"),this.totalObjects++,this.updateUI()}},reorderObjects:function(){if(!this.settings.sortable)return!1;for(var t=[],e=0;e<this.sorter.$items.length;e++){var s=$(this.sorter.$items[e]).attr(this.settings.idAttribute);t.push(s)}var i={ids:JSON.stringify(t)};Craft.postActionRequest(this.settings.reorderAction,i,$.proxy(function(e,s){"success"==s&&(e.success?(this.onReorderObjects(t),Craft.cp.displayNotice(Craft.t(this.settings.reorderSuccessMessage))):Craft.cp.displayError(Craft.t(this.settings.reorderFailMessage)))},this))},handleDeleteBtnClick:function(t){if(!(this.settings.minObjects&&this.totalObjects<=this.settings.minObjects)){var e=$(t.target).closest("tr");this.confirmDeleteObject(e)&&this.deleteObject(e)}},confirmDeleteObject:function(t){var e=this.getObjectName(t);return confirm(Craft.t(this.settings.confirmDeleteMessage,{name:e}))},deleteObject:function(t){var e={id:this.getObjectId(t)};Craft.postActionRequest(this.settings.deleteAction,e,$.proxy(function(e,s){"success"==s&&this.handleDeleteObjectResponse(e,t)},this))},handleDeleteObjectResponse:function(t,e){var s=this.getObjectId(e),i=this.getObjectName(e);t.success?(this.sorter&&this.sorter.removeItems(e),e.remove(),this.totalObjects--,this.updateUI(),this.onDeleteObject(s),Craft.cp.displayNotice(Craft.t(this.settings.deleteSuccessMessage,{name:Craft.escapeHtml(i)}))):Craft.cp.displayError(Craft.t(this.settings.deleteFailMessage,{name:Craft.escapeHtml(i)}))},onReorderObjects:function(t){this.settings.onReorderObjects(t)},onDeleteObject:function(t){this.settings.onDeleteObject(t)},getObjectId:function(t){return t.attr(this.settings.idAttribute)},getObjectName:function(t){return t.attr(this.settings.nameAttribute)},updateUI:function(){if(0==this.totalObjects?(this.$table.hide(),this.$noObjects.removeClass("hidden")):(this.$table.show(),this.$noObjects.addClass("hidden")),this.settings.sortable){var t=this.$table.find(".move");1==this.totalObjects?t.addClass("disabled"):t.removeClass("disabled")}this.settings.minObjects&&this.totalObjects<=this.settings.minObjects?this.$deleteBtns.addClass("disabled"):this.$deleteBtns.removeClass("disabled"),this.settings.newObjectBtnSelector&&(this.settings.maxObjects&&this.totalObjects>=this.settings.maxObjects?$(this.settings.newObjectBtnSelector).addClass("hidden"):$(this.settings.newObjectBtnSelector).removeClass("hidden"))}},{defaults:{tableSelector:null,noObjectsSelector:null,newObjectBtnSelector:null,idAttribute:"data-id",nameAttribute:"data-name",sortable:!1,allowDeleteAll:!0,minObjects:0,maxObjects:null,reorderAction:null,deleteAction:null,reorderSuccessMessage:Craft.t("New order saved."),reorderFailMessage:Craft.t("Couldn’t save new order."),confirmDeleteMessage:Craft.t("Are you sure you want to delete “{name}”?"),deleteSuccessMessage:Craft.t("“{name}” deleted."),deleteFailMessage:Craft.t("Couldn’t delete “{name}”."),onReorderObjects:$.noop,onDeleteObject:$.noop}});